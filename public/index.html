<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Australian Emergency Map</title>
    <meta name="viewport" content="width=device-width; initial-scale=1.0; user-scalable=0;">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icon-180.png" />
    <meta property="og:title" content="Australian Emergency Map" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://aus.emergencymap.info" />
    <meta property="og:description" content="Fire and emergency information, Australia." />
    <!-- <meta property="og:image" content="" /> -->
    <link rel="stylesheet" href="./leaflet/leaflet.css" />
    <link rel="stylesheet" href="./leaflet.fullscreen/Control.FullScreen.css" />
    <link rel="stylesheet" href="./normalize/normalize.css">
    <link rel="stylesheet" href="./index.css">
    <link rel="stylesheet" href="https://cdn.materialdesignicons.com/4.7.95/css/materialdesignicons.min.css">
  </head>
  <body>
    <div id="page" class="split">
      <div id="map"></div>
      <div id="vue" v-bind:class="'loaded'">
        <div id="sidebar">
          <div title="Menu" id="panelToggle" class="circle button" v-on:click.prevent="togglePanel()">
            <div class="mdi mdi-menu-open"></div>
          </div>
          <div title="Warning, all filters are unticked!" v-if="featuresFiltered.length == 0 && featuresAgeFiltered.length != 0" class="circle alert overlay">
            <div class="mdi mdi-close-box-multiple blink"></div>
          </div>
          <div v-else>
            <div title="Incidents" v-if="filterTree.incident._show" class="circle feature-incident">{{ filterTree.incident._count || 0 }}</div>
            <div title="Resources" v-if="filterTree._resources" class="circle feature-resources">{{ filterTree._resources || 0 }}</div>
            <div title="Warnings" v-if="filterTree.warning._show" class="circle feature-warning">{{ filterTree.warning._count || 0 }}</div>
            <div title="Other" v-if="filterTree.other._show" class="circle feature-other">{{ filterTree.other._count || 0 }}</div>
          </div>
          <div title="Some data failed to download" v-if="dataError" class="circle alert" v-on:click.prevent="fetchData()">
            <div class="mdi mdi-alert"></div>
          </div>
          <div title="Reload" class="circle button" v-on:click.prevent="fetchData()" v-bind:class="'animate rotate ' + (dataLoading ? 'running' : 'paused')">
            <div class="mdi mdi-refresh"></div>
          </div>
          <div title="Zoom map to current location" class="circle button small" v-on:click.prevent="zoomToUserLocation()">
            <div v-if="userLocation === null" class="mdi mdi-map-marker"></div>
            <div v-if="userLocation === true" class="mdi mdi-map-marker-check"></div>
            <div v-if="userLocation === false" class="mdi mdi-map-marker-alert-outline"></div>
          </div>
          <div title="Zoom map to show all data" class="circle button small" v-on:click.prevent="resetZoom()">
            <div class="mdi mdi-fit-to-page"></div>
          </div>
          <div title="Filters" class="circle button small" v-on:click.prevent="scrollTo('panelFilters')">
            <div class="mdi mdi-checkbox-marked"></div>
          </div>
          <div title="List" class="circle button small" v-on:click.prevent="scrollTo('panelList')">
            <div class="mdi mdi-view-list"></div>
          </div>
          <div title="Info" class="circle button small" v-on:click.prevent="scrollTo('panelInfo')">
            <div class="mdi mdi-help-circle"></div>
          </div>
          <div title="Share URL" v-if="shareableUrl" class="circle button small" v-on:click.prevent="prompt('Shareable URL for currently selected filters:', [shareableUrl])">
            <div class="mdi mdi-link-box-variant"></div>
          </div>
        </div>
        <div id="panel">
          <span id="panelTop"></span>
          <h1 v-on:click.prevent="debug()" style="font-size: 120%;">Australian Emergency Map</h1>
          <h2 id="panelFilters">Filters</h2>
          <p>
            Max age:
            <input type="number" min="0" max="200" step="1" v-model.lazy="maxAge" style="width: 3em;">
            hours
          </p>
          <p>
            <input type="range" min="0" value="10" max="200" step="1" v-model.lazy="maxAge" title="Max age (hours)">
          </p>
          <ol>
            <li>
              <label>
                <input type="checkbox" v-model="fadeWithAge">
                Fade-out with age
              </label>
            </li>
            <li>
              <label>
                <input type="checkbox" v-model="showResources">
                Show resources
              </label>
              <small v-if="filterTree._resources" class="badge feature-resources">{{ filterTree._resources }}</small>
            </li>
          </ol>
          <ol class="filterTree">
            <li>
              <label>
                <input type="checkbox" checked disabled>
                <strong>Data Source</strong>
              </label>
              <ol>
                <li v-for="(obj, src) in data" v-bind:key="src">
                  <label>
                    <input type="checkbox" v-model="data[src]._show">
                    {{ data[src].label }}
                  </label>
                </li>
              </ol>
            </li>
            <li v-for="(obj, feedType) in filterTree" v-if="feedType[0] != '_'" v-bind:key="feedType">
              <label>
                <input type="checkbox" v-model="obj._show">
                <strong>{{ feedType }}</strong>
              </label>
              <checkbox-toggles v-bind:obj="obj"></checkbox-toggles>
              <small v-if="obj._count" v-bind:class="'badge feature-' + feedType">{{ obj._count }}</small>
              <small v-else-if="obj._count_all" v-bind:class="'badge ghost'">{{ obj._count_all }}</small>
              <small v-if="showResources && obj._resources" class="badge feature-resources">{{ obj._resources }}</small>
              <ol>
                <li>
                  <em>Category</em>
                  <checkbox-toggles v-bind:obj="obj.category" v-bind:parents="[obj]"></checkbox-toggles>
                  <ol>
                    <li v-for="(subcategories, category) in obj.category" v-if="category[0] != '_'" v-bind:key="feedType + category">
                      <label>
                        <input type="checkbox" v-model="subcategories._show" v-on:change.lazy="obj._show = obj._show || subcategories._show">
                        {{ category }}
                      </label>
                      <checkbox-toggles v-bind:obj="subcategories" v-bind:parents="[obj, subcategories]"></checkbox-toggles>
                      <small v-if="subcategories._count" v-bind:class="'badge feature-' + feedType">{{ subcategories._count }}</small>
                      <small v-else-if="subcategories._count_all" v-bind:class="'badge ghost'">{{ subcategories._count_all }}</small>
                      <small v-if="showResources && subcategories._resources" class="badge feature-resources">{{ subcategories._resources }}</small>
                      <ol>
                        <li v-for="(opt, subcategory) in subcategories" v-bind:key="feedType + category + subcategory">
                          <label v-if="subcategory[0] != '_'">
                            <input type="checkbox" v-model="opt._show" v-on:change.lazy="obj._show = subcategories._show = obj._show || subcategories._show || opt._show">
                            {{ subcategory }}
                            <small v-if="opt._count" v-bind:class="'badge feature-' + feedType">{{ opt._count }}</small>
                            <small v-else-if="opt._count_all" v-bind:class="'badge ghost'">{{ opt._count_all }}</small>
                            <small v-if="showResources && opt._resources" class="badge feature-resources">{{ opt._resources }}</small>
                          </label>
                        </li>
                      </ol>
                    </li>
                  </ol>
                </li>
                <li>
                  <em>Status</em>
                  <checkbox-toggles v-bind:obj="obj.status" v-bind:parents="[obj]"></checkbox-toggles>
                  <ol>
                    <li v-for="(opt, status) in obj.status" v-bind:key="feedType + status">
                      <label v-if="status[0] != '_'">
                        <input type="checkbox" v-model="opt._show" v-on:change.lazy="obj._show = obj._show || opt._show">
                        {{ status }}
                        <small v-if="opt._count" v-bind:class="'badge feature-' + feedType">{{ opt._count }}</small>
                        <small v-else-if="opt._count_all" v-bind:class="'badge ghost'">{{ opt._count_all }}</small>
                        <small v-if="showResources && opt._resources" class="badge feature-resources">{{ opt._resources }}</small>
                      </label>
                    </li>
                  </ol>
                </li>
              </ol>
            </li>
          </ol>
          <h2 id="panelList">List</h2>
          <p>
            Resources:
            <span class="badge feature-resources"><span class="mdi mdi-fire-truck"></span> {{ filterTree._resources }}</span>
          </p>
          <p>
            Sort:
            <select v-model="sortBy">
              <option value="_age">date-time</option>
              <option>resources</option>
              <option>size</option>
            </select>
          </p>
          <ol>
            <li v-for="feature in featuresFiltered" v-bind:key="fid(feature)" v-bind:id="'featureListItem' + fid(feature)" v-on:click="selectFeature(feature)" v-bind:class="'feature ' + (fid(feature) == featureSelected ? 'selected' : '')">
              <h3>{{ feature.properties.sourceTitle }}</h3>
              <p>
                {{ feature.properties._date_f }}
              </p>
              <p v-html="feature.properties.location"></p>
              <p v-if="feature.properties.resources">
                Resources:
                <span class="badge feature-resources"><span class="mdi mdi-fire-truck"></span> {{ feature.properties.resources }}</span>
              </p>
              <p v-if="feature.properties.size">
                Size: {{ feature.properties.size }}
              </p>
              <div v-if="fid(feature) == featureSelected">
                <p v-if="feature.properties.text" v-text="feature.properties.text"></p>
                <p v-else-if="feature.properties.description" v-html="feature.properties.description"></p>
                <p>
                  <a v-if="feature.properties.link || feature.properties.url" v-bind:href="feature.properties.link || feature.properties.url" target="_blank">
                    more information
                  </a>
                </p>
              </div>
            </li>
          </ol>
          <p v-if="featuresFiltered.length == 0">No items.</p>
          <div id="panelInfo">
            <h2>About This Page</h2>
            <p>This page is in no way officially affiliated with any State Government or data source.</p>
            <p>
              <a href="https://github.com/reillybeacom/aus-emergency-map">
                Source code available on Github
              </a>
            </p>
            <p>Proudly built with free, open-source software:</p>
            <ul>
              <li>
                <a href="http://leafletjs.com/">Leaflet</a>
              </li>
              <li>
                <a href="https://www.openstreetmap.org/about">OpenStreetMap</a>
              </li>
              <li>
                <a href="https://vuejs.org/">Vue.js</a>
              </li>
              <li>
                <a href="https://www.mozilla.org/en-US/firefox/">Firefox</a>
              </li>
            </ul>
            <p style="font-size: 70%; color: grey;">
              THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
              IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
              FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
              AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
              LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
              OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
              THE SOFTWARE.
            </p>
            <br/>
            <br/>
          </div>
        </div>
      </div>
    </div>
    <script src="./axios/axios.min.js"></script>
    <script src="./leaflet/leaflet.js"></script>
    <script src="./leaflet.fullscreen/Control.FullScreen.js"></script>
    <script src="./vue/vue.min.js"></script>
    <script src="./cookies/cookies.js"></script>
    <script src="./togeojson/togeojson.js"></script>
    <script src="./togpx/togpx.js"></script>
    <script src="./moment/moment.min.js"></script>
    <script src="./moment/moment-timezone-with-data-10-year-range.min.js"></script>
    <script src="./utils.js"></script>
    <script src="./index.js"></script>
  </body>
</html>
